# Введение в SQL функции

---
В SQL функции представляют собой набор инструкций для выполнения конкретной задачи или вычисления значений. Они могут использоваться для упрощения кода запросов, повторного использования логики вычислений и обеспечения модульности запросов. SQL предлагает различные типы функций, включая встроенные (built-in), пользовательские (user-defined) и оконные (window) функции.

### Встроенные функции

Встроенные функции в SQL являются частью системы управления базами данных (СУБД) и предоставляют базовую функциональность для работы с данными. Примеры встроенных функций включают функции математических операций (например, SUM, AVG, MIN, MAX), функции строки (например, CONCAT, UPPER, LOWER) и функции даты/времени (например, DATEPART, DATEDIFF).

### Пользовательские функции

Пользовательские функции создаются пользователем для выполнения специфических задач. Они могут быть определены и использованы в SQL запросах для упрощения сложной логики или повторного использования команд. Пользовательские функции могут быть скалярными (возвращающими одно значение) или табличными (возвращающими таблицу результатов).

---

### Оконные функции

Оконные функции позволяют выполнять вычисления на наборе рядов данных, называемом "окном". Они могут использоваться для расчета накопительных сумм, ранжирования данных, вычисления относительных значений и других аналитических операций.

### Пишем свои первые функции SQL

```sql
-- Пример встроенной функции
SELECT AVG(salary) AS avg_salary FROM employees;

-- Пример пользовательской функции
CREATE FUNCTION calculate_discount(price DECIMAL, discount_rate DECIMAL)
RETURNS DECIMAL
AS
BEGIN
    DECLARE discounted_price DECIMAL;
    SET discounted_price = price - (price * discount_rate);
    RETURN discounted_price;
END;

-- Пример оконной функции
SELECT department, employee_name, salary, 
       ROW_NUMBER() OVER(PARTITION BY department ORDER BY salary DESC) AS rank_by_salary
FROM employees;

### Скалярные функции 

Скалярные функции в SQL возвращают одно значение на основе входных параметров. Они могут использоваться в SQL запросах для различных целей, таких как преобразование данных, выполнение вычислений, обработка строк и дат, и многих других операций. Вот несколько примеров скалярных функций:

#### Математические функции
Скалярные функции могут использоваться для выполнения математических операций, таких как сложение, вычитание, умножение, деление и возведение в степень. Например:
sql
SELECT SQRT(column_name) AS square_root FROM table_name;
-- Этот запрос возвращает квадратный корень значения из столбца column_name.

#### Строковые функции
Скалярные функции также могут использоваться для обработки строк, такие как конкатенация строк, изменение регистра, извлечение подстрок и другие операции. Например:


##### Аргументы функций SQL: IN, OUT, DEFAULT

- **IN**: Аргумент с ключевым словом IN представляет собой входной параметр для функции. Это означает, что значение этого аргумента передается в функцию извне.

- **OUT**: Аргумент с ключевым словом OUT представляет собой выходной параметр для функции. Это означает, что значение этого аргумента будет возвращено из функции и может быть использовано вне функции.

- **DEFAULT**: DEFAULT используется для задания значения по умолчанию для аргумента функции. Если значение не передается для аргумента, которому установлено значение по умолчанию, будет использовано значение по умолчанию.

#### Возврат наборов данных

Возвращаемые наборы данных: В SQL функции могут возвращать наборы данных в виде результирующих наборов, что позволяет функции возвращать не только одно значение, а целый набор результатов. Такие функции обычно называются "табличными" функциями или функциями, возвращающими таблицы.

--Пример использования функции, возвращающей наборы данных:


CREATE FUNCTION getEmployeesByDepartment(IN departmentId INT)
RETURNS TABLE
AS
RETURN (
    SELECT * FROM employees WHERE department_id = departmentId;
);
В этом примере функция getEmployeesByDepartment принимает departmentId в качестве параметра и возвращает все записи из таблицы employees для указанного отдела.